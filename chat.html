<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgriMitra AI Chat</title>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f0f4f7;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      background: #ff9800;
      color: white;
      padding: 15px;
      font-size: 20px;
      text-align: center;
      font-weight: bold;
    }
    #chat-box {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      display: flex;
      flex-direction: column;
    }
    .msg {
      max-width: 80%;
      margin-bottom: 10px;
      padding: 10px 15px;
      border-radius: 15px;
      line-height: 1.4;
      font-size: 14px;
      word-wrap: break-word;
    }
    .user {
      background: #ffe0b2;
      align-self: flex-end;
    }
    .bot {
      background: #fff;
      border: 1px solid #ddd;
      align-self: flex-start;
    }
    .img-preview {
      max-width: 200px;
      border-radius: 10px;
      margin-top: 5px;
    }

    #input-area {
      display: flex;
      padding: 10px;
      background: #fff;
      border-top: 1px solid #ddd;
      align-items: center;
      gap: 6px;
    }
    input {
      flex: 1;
      padding: 10px;
      border-radius: 20px;
      border: 1px solid #ccc;
      outline: none;
    }
    button {
      padding: 10px 12px;
      border: none;
      border-radius: 50%;
      background: #ff9800;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }
    #file-input {
      display: none;
    }
  </style>
</head>

<body>

<header>ЁЯЪЬ AgriMitra AI Chat</header>

<div id="chat-box">
  <div class="msg bot">рдирдорд╕реНрдХрд╛рд░ ЁЯСЛ рдореА рддреБрдордЪрд╛ рд╢реЗрддреА AI рд╕рд╣рд╛рдпреНрдпрдХ рдЖрд╣реЗ. рдкреНрд░рд╢реНрди рдЯрд╛рдХрд╛ рдХрд┐рдВрд╡рд╛ рдкрд┐рдХрд╛рдЪрд╛ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░рд╛ ЁЯУ╖</div>
</div>

<div id="input-area">
  <input type="text" id="user-input" placeholder="рдкреНрд░рд╢реНрди рд▓рд┐рд╣рд╛...">
  <button id="photo-btn">ЁЯУ╖</button>
  <input type="file" id="file-input" accept="image/*">
  <button id="send-btn">тЮд</button>
</div>

<script>
  const chatBox = document.getElementById("chat-box");
  const userInput = document.getElementById("user-input");
  const sendBtn = document.getElementById("send-btn");
  const fileInput = document.getElementById("file-input");
  const photoBtn = document.getElementById("photo-btn");

  function addMessage(text, type) {
    const div = document.createElement("div");
    div.className = "msg " + type;
    div.textContent = text;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function addImage(src) {
    const img = document.createElement("img");
    img.src = src;
    img.className = "img-preview";
    chatBox.appendChild(img);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  async function sendToAI(text, imageBase64 = null, mimeType = null) {
    addMessage("тП│ рд╡рд┐рдЪрд╛рд░ рдХрд░рдд рдЖрд╣реЗ...", "bot");

    const body = imageBase64 ? {
      message: "рдпрд╛ рдкрд┐рдХрд╛рдЪрд╛ рдлреЛрдЯреЛ рдкрд╛рд╣реВрди рд░реЛрдЧ рдУрд│рдЦрд╛ рдЖрдгрд┐ рдЙрдкрд╛рдп рд╕рд╛рдВрдЧрд╛.",
      image: imageBase64,
      mimeType: mimeType
    } : { message: text };

    const res = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });

    const data = await res.json();
    chatBox.lastChild.remove();
    addMessage(data.reply || "рдХреНрд╖рдорд╕реНрд╡, рдЙрддреНрддрд░ рдорд┐рд│рд╛рд▓реЗ рдирд╛рд╣реА.", "bot");
  }

  sendBtn.onclick = () => {
    const text = userInput.value.trim();
    if (!text) return;
    addMessage(text, "user");
    userInput.value = "";
    sendToAI(text);
  };

  photoBtn.onclick = () => fileInput.click();

  fileInput.onchange = () => {
    const file = fileInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = async () => {
      addImage(reader.result);
      const base64 = reader.result.split(",")[1];
      sendToAI("", base64, file.type);
    };
    reader.readAsDataURL(file);
  };
</script>

</body>
</html>
